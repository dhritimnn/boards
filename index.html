<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boards Exam Prep</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.1/font/bootstrap-icons.min.css">
    <style>
        /* Custom Checkbox Styles */
        .custom-checkbox {
            appearance: none;
            width: 1.5rem;
            height: 1.5rem;
            border: 2px solid #d1d5db;
            border-radius: 0.375rem;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
        }
        
        .custom-checkbox:hover {
            border-color: #3b82f6;
        }
        
        .custom-checkbox:checked {
            background-color: #3b82f6;
            border-color: #3b82f6;
        }
        
        .custom-checkbox:checked::after {
            content: '';
            position: absolute;
            left: 0.45rem;
            top: 0.2rem;
            width: 0.35rem;
            height: 0.65rem;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        .custom-checkbox-sm {
            width: 1.25rem;
            height: 1.25rem;
        }

        .custom-checkbox-sm:checked::after {
            left: 0.35rem;
            top: 0.15rem;
            width: 0.3rem;
            height: 0.55rem;
        }

        .subject-checkbox {
            appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid #d1d5db;
            border-radius: 0.25rem;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
        }

        .subject-checkbox:hover {
            border-color: #8b5cf6;
        }

        .subject-checkbox:checked {
            background-color: #8b5cf6;
            border-color: #8b5cf6;
        }

        .subject-checkbox:checked::after {
            content: '';
            position: absolute;
            left: 0.35rem;
            top: 0.1rem;
            width: 0.3rem;
            height: 0.6rem;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4">
    <div class="max-w-3xl mx-auto">
        <!-- Header Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-4">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center gap-3">
                    <i class="bi bi-book-fill text-3xl text-blue-600"></i>
                    <h1 class="text-2xl font-bold text-gray-800">Boards Exam Prep</h1>
                </div>
                <div class="text-lg font-semibold text-gray-700">
                    Day <span id="currentDay">1</span>/<span id="totalDays">20</span>
                </div>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3">
                <div id="dayProgress" class="bg-blue-600 h-3 rounded-full transition-all duration-300" style="width: 5%"></div>
            </div>
        </div>

        <!-- Subject Selection Section -->
        <div class="bg-white rounded-lg shadow-md mb-4">
            <div class="p-4 flex justify-between items-center cursor-pointer" onclick="toggleSubjectSection()">
                <h2 class="text-xl font-semibold text-gray-800">Subject Selection</h2>
                <button class="text-blue-600 hover:text-blue-800">
                    <i class="bi bi-pencil-square text-xl"></i>
                </button>
            </div>
            <div id="subjectSection" class="hidden p-4 pt-0">
                <div class="space-y-3 mb-4">
                    <div class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition">
                        <input type="checkbox" id="sub-assamese" value="Assamese" class="subject-checkbox">
                        <label for="sub-assamese" class="text-gray-700 cursor-pointer flex-1">Assamese</label>
                    </div>
                    <div class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition">
                        <input type="checkbox" id="sub-english" value="English" class="subject-checkbox">
                        <label for="sub-english" class="text-gray-700 cursor-pointer flex-1">English</label>
                    </div>
                    <div class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition">
                        <input type="checkbox" id="sub-social" value="Social Studies" class="subject-checkbox">
                        <label for="sub-social" class="text-gray-700 cursor-pointer flex-1">Social Studies</label>
                    </div>
                    <div class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition">
                        <input type="checkbox" id="sub-science" value="Science" class="subject-checkbox">
                        <label for="sub-science" class="text-gray-700 cursor-pointer flex-1">Science</label>
                    </div>
                    <div class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition">
                        <input type="checkbox" id="sub-maths" value="Maths" class="subject-checkbox">
                        <label for="sub-maths" class="text-gray-700 cursor-pointer flex-1">Maths</label>
                    </div>
                    <div class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition">
                        <input type="checkbox" id="sub-elective" value="Elective" class="subject-checkbox">
                        <label for="sub-elective" class="text-gray-700 cursor-pointer flex-1">Elective</label>
                    </div>
                </div>
                <button onclick="completeSelection()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition font-semibold">
                    Complete Selection
                </button>
            </div>
        </div>

        <!-- Today's Task List -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-4">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Today's Task List</h2>
            <div id="taskList" class="space-y-4 mb-4">
                <p class="text-gray-500 text-center py-4">Please select subjects first</p>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3 mt-4">
                <div id="taskProgress" class="bg-green-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            <p class="text-center text-sm text-gray-600 mt-2">
                <span id="progressText">0%</span> Complete
            </p>
        </div>

        <!-- End the Day Button -->
        <button onclick="showEndDayPopup()" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition shadow-md mb-4 text-lg font-semibold">
            End the Day
        </button>

        <!-- Previous Days Section -->
        <div class="bg-white rounded-lg shadow-md">
            <div class="p-4 flex justify-between items-center cursor-pointer" onclick="togglePreviousDays()">
                <h2 class="text-lg font-semibold text-gray-800">See Previous Days</h2>
                <i id="prevDaysIcon" class="bi bi-chevron-down text-xl"></i>
            </div>
            <div id="previousDaysContent" class="hidden p-4 pt-0">
                <div id="previousDaysList"></div>
            </div>
        </div>
    </div>

    <!-- End Day Popup -->
    <div id="endDayPopup" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-gray-800">How it went?</h3>
                <button onclick="closeEndDayPopup()" class="text-gray-500 hover:text-gray-700">
                    <i class="bi bi-x-lg text-2xl"></i>
                </button>
            </div>
            <div class="mb-4 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-600">
                <p id="dailyQuote" class="text-gray-700 italic"></p>
            </div>
            <textarea id="reflectionText" placeholder="Write your thoughts about today..." class="w-full border border-gray-300 rounded-lg p-3 mb-4 h-32 resize-none focus:ring-2 focus:ring-purple-600 focus:border-transparent"></textarea>
            <button onclick="submitEndDay()" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition font-semibold">
                Submit
            </button>
        </div>
    </div>

    <script>
        const quotes = [
            "Success is the sum of small efforts repeated day in and day out.",
            "The expert in anything was once a beginner.",
            "Study while others are sleeping; work while others are loafing.",
            "Education is the passport to the future.",
            "The beautiful thing about learning is that no one can take it away from you.",
            "Don't watch the clock; do what it does. Keep going."
        ];

        let tdata = {};
        let mdata = [];

        function init() {
            loadData();
            updateUI();
            loadPreviousDays();
        }

        function loadData() {
            const today = new Date().toDateString();
            tdata = JSON.parse(localStorage.getItem('tdata') || '{}');
            mdata = JSON.parse(localStorage.getItem('mdata') || '[]');

            if (tdata.date !== today) {
                const newDay = Math.min((tdata.day || 0) + 1, 20);
                tdata = {
                    date: today,
                    day: newDay,
                    subjects: tdata.subjects || [],
                    tasks: []
                };
                saveTData();
            }
        }

        function saveTData() {
            localStorage.setItem('tdata', JSON.stringify(tdata));
        }

        function updateUI() {
            document.getElementById('currentDay').textContent = tdata.day || 1;
            const progress = ((tdata.day || 1) / 20) * 100;
            document.getElementById('dayProgress').style.width = progress + '%';

            const checkboxes = document.querySelectorAll('#subjectSection input[type="checkbox"]');
            checkboxes.forEach(cb => {
                cb.checked = tdata.subjects.includes(cb.value);
            });

            renderTasks();
            updateTaskProgress();
        }

        function toggleSubjectSection() {
            const section = document.getElementById('subjectSection');
            section.classList.toggle('hidden');
        }

        function completeSelection() {
            const checkboxes = document.querySelectorAll('#subjectSection input[type="checkbox"]:checked');
            tdata.subjects = Array.from(checkboxes).map(cb => cb.value);
            
            tdata.tasks = tdata.subjects.map(subject => ({
                id: Date.now() + Math.random(),
                subject: subject,
                completed: false,
                subtasks: []
            }));

            saveTData();
            toggleSubjectSection();
            renderTasks();
            updateTaskProgress();
        }

        function renderTasks() {
            const taskList = document.getElementById('taskList');
            
            if (!tdata.tasks || tdata.tasks.length === 0) {
                taskList.innerHTML = '<p class="text-gray-500 text-center py-4">Please select subjects first</p>';
                return;
            }

            taskList.innerHTML = tdata.tasks.map(task => `
                <div class="border-2 border-gray-200 rounded-lg p-4 hover:border-blue-300 transition">
                    <div class="flex items-start gap-3">
                        <input type="checkbox" ${task.completed ? 'checked' : ''} 
                               onchange="toggleTask(${task.id})"
                               class="custom-checkbox mt-1">
                        <div class="flex-1">
                            <label class="text-lg font-semibold text-gray-800 cursor-pointer ${task.completed ? 'line-through text-gray-500' : ''}">${task.subject}</label>
                            <div class="mt-3 space-y-2" id="subtasks-${task.id}">
                                ${task.subtasks.map(st => `
                                    <div class="flex items-center gap-3 ml-4 p-2 rounded hover:bg-gray-50 transition">
                                        <input type="checkbox" ${st.completed ? 'checked' : ''} 
                                               onchange="toggleSubtask(${task.id}, ${st.id})"
                                               class="custom-checkbox-sm">
                                        <span class="text-gray-700 flex-1 ${st.completed ? 'line-through text-gray-500' : ''}">${st.name}</span>
                                        <button onclick="deleteSubtask(${task.id}, ${st.id})" class="text-red-500 hover:text-red-700 p-1">
                                            <i class="bi bi-trash text-sm"></i>
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                            <button onclick="addSubtask(${task.id})" class="mt-3 ml-4 text-blue-600 hover:text-blue-800 text-sm flex items-center gap-1 font-medium">
                                <i class="bi bi-plus-circle"></i> Add Subtask
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleTask(taskId) {
            const task = tdata.tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                
                // If task is checked, check all subtasks
                if (task.completed) {
                    task.subtasks.forEach(st => st.completed = true);
                }
                
                saveTData();
                renderTasks();
                updateTaskProgress();
            }
        }

        function addSubtask(taskId) {
            const name = prompt('Enter subtask name:');
            if (name && name.trim()) {
                const task = tdata.tasks.find(t => t.id === taskId);
                if (task) {
                    task.subtasks.push({
                        id: Date.now() + Math.random(),
                        name: name.trim(),
                        completed: false
                    });
                    saveTData();
                    renderTasks();
                    updateTaskProgress();
                }
            }
        }

        function toggleSubtask(taskId, subtaskId) {
            const task = tdata.tasks.find(t => t.id === taskId);
            if (task) {
                const subtask = task.subtasks.find(st => st.id === subtaskId);
                if (subtask) {
                    subtask.completed = !subtask.completed;
                    
                    // Check if all subtasks are completed
                    const allSubtasksCompleted = task.subtasks.every(st => st.completed);
                    
                    // If all subtasks are completed, check the main task
                    if (allSubtasksCompleted && task.subtasks.length > 0) {
                        task.completed = true;
                    }
                    
                    // If a subtask is unchecked, uncheck the main task
                    if (!subtask.completed) {
                        task.completed = false;
                    }
                    
                    saveTData();
                    renderTasks();
                    updateTaskProgress();
                }
            }
        }

        function deleteSubtask(taskId, subtaskId) {
            const task = tdata.tasks.find(t => t.id === taskId);
            if (task) {
                task.subtasks = task.subtasks.filter(st => st.id !== subtaskId);
                saveTData();
                renderTasks();
                updateTaskProgress();
            }
        }

        function updateTaskProgress() {
            if (!tdata.tasks || tdata.tasks.length === 0) {
                document.getElementById('taskProgress').style.width = '0%';
                document.getElementById('progressText').textContent = '0%';
                return;
            }

            const totalSubjects = tdata.tasks.length;
            const percentPerSubject = 100 / totalSubjects;
            let totalProgress = 0;

            tdata.tasks.forEach(task => {
                if (task.subtasks.length === 0) {
                    // No subtasks - main task counts as full subject progress
                    if (task.completed) {
                        totalProgress += percentPerSubject;
                    }
                } else {
                    // Has subtasks - each subtask counts equally within this subject
                    const percentPerSubtask = percentPerSubject / task.subtasks.length;
                    task.subtasks.forEach(st => {
                        if (st.completed) {
                            totalProgress += percentPerSubtask;
                        }
                    });
                }
            });

            const finalProgress = Math.round(totalProgress);
            document.getElementById('taskProgress').style.width = finalProgress + '%';
            document.getElementById('progressText').textContent = finalProgress + '%';
        }

        function showEndDayPopup() {
            document.getElementById('endDayPopup').classList.remove('hidden');
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            document.getElementById('dailyQuote').textContent = randomQuote;
        }

        function closeEndDayPopup() {
            document.getElementById('endDayPopup').classList.add('hidden');
            document.getElementById('reflectionText').value = '';
        }

        function submitEndDay() {
            const reflection = document.getElementById('reflectionText').value;
            const quote = document.getElementById('dailyQuote').textContent;

            const progress = parseInt(document.getElementById('progressText').textContent);

            const dayData = {
                date: tdata.date,
                day: tdata.day,
                tasks: tdata.tasks.map(task => ({
                    subject: task.subject,
                    completed: task.completed,
                    subtasks: task.subtasks
                })),
                progress: progress,
                reflection: reflection,
                quote: quote
            };

            mdata.push(dayData);
            localStorage.setItem('mdata', JSON.stringify(mdata));

            closeEndDayPopup();
            loadPreviousDays();
            alert('Day saved successfully!');
        }

        function togglePreviousDays() {
            const content = document.getElementById('previousDaysContent');
            const icon = document.getElementById('prevDaysIcon');
            content.classList.toggle('hidden');
            icon.classList.toggle('bi-chevron-down');
            icon.classList.toggle('bi-chevron-up');
        }

        function loadPreviousDays() {
            const container = document.getElementById('previousDaysList');
            
            if (mdata.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">No previous days recorded yet</p>';
                return;
          
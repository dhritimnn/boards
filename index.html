<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Track your 20-day board exam preparation">
  <meta name="theme-color" content="#4f46e5">
  <title>Board Exam Study Tracker</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  
  <!-- iOS Support -->
  <link rel="apple-touch-icon" href="/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Study Tracker">
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Lucide Icons - Load FIRST -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  
  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    // Create React components from Lucide icons
    const BookOpen = (props) => <i data-lucide="book-open" {...props}></i>;
    const CheckCircle = (props) => <i data-lucide="check-circle" {...props}></i>;
    const Circle = (props) => <i data-lucide="circle" {...props}></i>;
    const Edit2 = (props) => <i data-lucide="edit-2" {...props}></i>;
    const Star = (props) => <i data-lucide="star" {...props}></i>;
    const Calendar = (props) => <i data-lucide="calendar" {...props}></i>;
    const Clock = (props) => <i data-lucide="clock" {...props}></i>;
    const BookMarked = (props) => <i data-lucide="book-marked" {...props}></i>;
    const Sparkles = (props) => <i data-lucide="sparkles" {...props}></i>;
    
    const { useState, useEffect } = React;
    
    // Initialize Lucide icons after render
    const useLucideIcons = () => {
      useEffect(() => {
        if (window.lucide) {
          window.lucide.createIcons();
        }
      });
    };
    
    function StudyTracker() {
      // PWA Installation
      useEffect(() => {
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register('/service-worker.js').catch(() => {});
        }
      }, []);
      
      // Initialize Lucide icons
      useLucideIcons();

      const START_DATE = '2026-01-03';
      
      const allSubjects = [
        { name: 'Assamese', priority: true },
        { name: 'English', priority: false },
        { name: 'Maths', priority: false },
        { name: 'Elective', priority: false },
        { name: 'Science', priority: false },
        { name: 'Social Studies', priority: true }
      ];

      const motivationalQuotes = [
        "Success is the sum of small efforts repeated day in and day out. Keep going! ðŸŒŸ",
        "Today's accomplishments were tomorrow's impossibilities. Well done! ðŸ’ª",
        "You're one day closer to your goal. Stay focused! ðŸŽ¯",
        "Every day is a new opportunity to get better. Great work today! âœ¨",
        "Consistency is key. You showed up today - that's what matters! ðŸ”¥",
        "Small progress is still progress. Be proud of yourself! ðŸŒ±",
        "Your future self will thank you for the work you did today! ðŸš€",
        "Education is the passport to the future. Keep stamping it! ðŸ“š",
        "The expert in anything was once a beginner. You're getting there! ðŸ’«",
        "Believe in yourself and all that you are. Tomorrow is another chance! ðŸŒˆ"
      ];

      const getCurrentDay = () => {
        const start = new Date(START_DATE);
        const today = new Date();
        const diffTime = today - start;
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
        return Math.min(Math.max(diffDays + 1, 1), 20);
      };

      const getCurrentDate = () => {
        return new Date().toISOString().split('T')[0];
      };

      const [currentDay, setCurrentDay] = useState(getCurrentDay());
      const [lastVisitDate, setLastVisitDate] = useState(() => {
        return localStorage.getItem('lastVisitDate') || '';
      });
      const [showSelectionPopup, setShowSelectionPopup] = useState(false);
      const [showEndDayPopup, setShowEndDayPopup] = useState(false);
      const [showQuotePopup, setShowQuotePopup] = useState(false);
      const [showReflectionsPopup, setShowReflectionsPopup] = useState(false);
      const [selectedSubjects, setSelectedSubjects] = useState([]);
      const [tempSelection, setTempSelection] = useState([]);
      const [tasks, setTasks] = useState([]);
      const [reflectionText, setReflectionText] = useState('');
      const [currentQuote, setCurrentQuote] = useState('');
      const [reflections, setReflections] = useState(() => {
        const saved = localStorage.getItem('reflections');
        return saved ? JSON.parse(saved) : [];
      });

      useEffect(() => {
        const today = getCurrentDate();
        if (today !== lastVisitDate) {
          setLastVisitDate(today);
          localStorage.setItem('lastVisitDate', today);
          setShowSelectionPopup(true);
          setSelectedSubjects([]);
          setTasks([]);
          setCurrentDay(getCurrentDay());
        }
      }, []);

      const toggleTempSelection = (subjectName) => {
        setTempSelection(prev => 
          prev.includes(subjectName)
            ? prev.filter(s => s !== subjectName)
            : [...prev, subjectName]
        );
      };

      const completeSelection = () => {
        if (tempSelection.length === 0) return;
        
        setSelectedSubjects(tempSelection);
        setTasks(tempSelection.map(name => ({
          subject: allSubjects.find(s => s.name === name),
          completed: false,
          notes: ''
        })));
        setShowSelectionPopup(false);
        setTempSelection([]);
      };

      const openEditSelection = () => {
        setTempSelection(selectedSubjects);
        setShowSelectionPopup(true);
      };

      const toggleTask = (subjectName) => {
        setTasks(prev => prev.map(t => 
          t.subject.name === subjectName 
            ? { ...t, completed: !t.completed }
            : t
        ));
      };

      const updateNotes = (subjectName, notes) => {
        setTasks(prev => prev.map(t => 
          t.subject.name === subjectName 
            ? { ...t, notes }
            : t
        ));
      };

      const handleEndDay = () => {
        setShowEndDayPopup(true);
      };

      const submitReflection = () => {
        if (!reflectionText.trim()) return;

        const newReflection = {
          day: currentDay,
          date: getCurrentDate(),
          reflection: reflectionText,
          subjects: tasks.map(t => ({
            name: t.subject.name,
            completed: t.completed,
            notes: t.notes
          }))
        };

        const updatedReflections = [...reflections, newReflection];
        setReflections(updatedReflections);
        localStorage.setItem('reflections', JSON.stringify(updatedReflections));

        const randomQuote = motivationalQuotes[Math.floor(Math.random() * motivationalQuotes.length)];
        setCurrentQuote(randomQuote);
        setShowEndDayPopup(false);
        setShowQuotePopup(true);
        setReflectionText('');
      };

      const closeQuoteAndReset = () => {
        setShowQuotePopup(false);
        const newDate = getCurrentDate();
        const tomorrow = new Date(newDate);
        tomorrow.setDate(tomorrow.getDate() + 1);
        const tomorrowStr = tomorrow.toISOString().split('T')[0];
        
        setLastVisitDate(tomorrowStr);
        localStorage.setItem('lastVisitDate', tomorrowStr);
        setSelectedSubjects([]);
        setTasks([]);
        setCurrentDay(prev => Math.min(prev + 1, 20));
        setShowSelectionPopup(true);
      };

      const formatDate = (dateStr) => {
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-US', { 
          weekday: 'long',
          month: 'long', 
          day: 'numeric', 
          year: 'numeric' 
        });
      };

      const formatShortDate = (dateStr) => {
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-US', { 
          month: 'short', 
          day: 'numeric', 
          year: 'numeric' 
        });
      };

      const completedCount = tasks.filter(t => t.completed).length;
      const totalCount = tasks.length;

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
          {showSelectionPopup && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-lg shadow-2xl max-w-md w-full p-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-2">Select Today's Subjects</h2>
                <p className="text-sm text-gray-600 mb-6">Choose which subjects you'll study today</p>
                
                <div className="space-y-3 mb-6">
                  {allSubjects.map(subject => (
                    <button
                      key={subject.name}
                      onClick={() => toggleTempSelection(subject.name)}
                      className={`w-full p-4 rounded-lg border-2 transition-all flex items-center justify-between ${
                        tempSelection.includes(subject.name)
                          ? 'border-indigo-500 bg-indigo-50'
                          : 'border-gray-200 hover:border-indigo-300'
                      }`}
                    >
                      <div className="flex items-center gap-3">
                        {tempSelection.includes(subject.name) ? (
                          <CheckCircle className="text-indigo-600" size={24} />
                        ) : (
                          <Circle className="text-gray-400" size={24} />
                        )}
                        <span className="font-medium text-gray-800">{subject.name}</span>
                      </div>
                      {subject.priority && (
                        <Star className="text-yellow-500" size={18} fill="currentColor" />
                      )}
                    </button>
                  ))}
                </div>

                <button
                  onClick={completeSelection}
                  disabled={tempSelection.length === 0}
                  className={`w-full py-3 rounded-lg font-semibold transition-all ${
                    tempSelection.length === 0
                      ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                      : 'bg-indigo-600 text-white hover:bg-indigo-700'
                  }`}
                >
                  Complete Selection ({tempSelection.length} subjects)
                </button>
              </div>
            </div>
          )}

          {showEndDayPopup && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-lg shadow-2xl max-w-lg w-full p-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2">
                  <BookMarked className="text-indigo-600" size={28} />
                  How Did Today Go?
                </h2>
                <p className="text-sm text-gray-600 mb-6">Reflect on your day before moving forward</p>
                
                <textarea
                  value={reflectionText}
                  onChange={(e) => setReflectionText(e.target.value)}
                  placeholder="Write about your day... What went well? What was challenging? How do you feel about your progress?"
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none"
                  rows="6"
                />

                <div className="flex gap-3 mt-6">
                  <button
                    onClick={() => setShowEndDayPopup(false)}
                    className="flex-1 py-3 rounded-lg font-semibold bg-gray-200 text-gray-700 hover:bg-gray-300 transition-all"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={submitReflection}
                    disabled={!reflectionText.trim()}
                    className={`flex-1 py-3 rounded-lg font-semibold transition-all ${
                      !reflectionText.trim()
                        ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                        : 'bg-indigo-600 text-white hover:bg-indigo-700'
                    }`}
                  >
                    Submit & End Day
                  </button>
                </div>
              </div>
            </div>
          )}

          {showQuotePopup && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-lg shadow-2xl max-w-md w-full p-8 text-center">
                <Sparkles className="text-yellow-500 mx-auto mb-4" size={48} />
                <p className="text-xl text-gray-800 mb-6 leading-relaxed italic">
                  "{currentQuote}"
                </p>
                <button
                  onClick={closeQuoteAndReset}
                  className="px-6 py-3 rounded-lg font-semibold bg-indigo-600 text-white hover:bg-indigo-700 transition-all"
                >
                  Start Next Day
                </button>
              </div>
            </div>
          )}

          {showReflectionsPopup && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-lg shadow-2xl max-w-3xl w-full max-h-[80vh] overflow-hidden flex flex-col">
                <div className="p-6 border-b">
                  <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                    <BookMarked className="text-indigo-600" size={28} />
                    Past Reflections
                  </h2>
                </div>
                
                <div className="flex-1 overflow-y-auto p-6">
                  {reflections.length === 0 ? (
                    <div className="text-center py-12 text-gray-400">
                      <BookMarked size={64} className="mx-auto mb-4 opacity-50" />
                      <p className="text-lg">No reflections yet</p>
                      <p className="text-sm">Complete your first day to see reflections here</p>
                    </div>
                  ) : (
                    <div className="space-y-6">
                      {[...reflections].reverse().map((ref, idx) => (
                        <div key={idx} className="bg-gray-50 rounded-lg p-5 border-l-4 border-indigo-500">
                          <div className="flex items-center justify-between mb-3">
                            <div>
                              <h3 className="font-bold text-lg text-gray-800">Day {ref.day}</h3>
                              <p className="text-sm text-gray-600">{formatShortDate(ref.date)}</p>
                            </div>
                          </div>
                          
                          <div className="mb-3">
                            <p className="text-sm font-semibold text-gray-700 mb-2">Subjects Studied:</p>
                            <div className="flex flex-wrap gap-2">
                              {ref.subjects.map(subj => (
                                <span
                                  key={subj.name}
                                  className={`px-3 py-1 rounded-full text-xs font-medium ${
                                    subj.completed
                                      ? 'bg-green-100 text-green-700'
                                      : 'bg-gray-200 text-gray-600'
                                  }`}
                                >
                                  {subj.name} {subj.completed && 'âœ“'}
                                </span>
                              ))}
                            </div>
                          </div>
                          
                          <div>
                            <p className="text-sm font-semibold text-gray-700 mb-2">Reflection:</p>
                            <p className="text-gray-700 whitespace-pre-wrap">{ref.reflection}</p>
                          </div>
                          
                          {ref.subjects.some(s => s.notes) && (
                            <div className="mt-3 pt-3 border-t">
                              <p className="text-sm font-semibold text-gray-700 mb-2">Study Notes:</p>
                              <div className="space-y-1">
                                {ref.subjects.filter(s => s.notes).map(subj => (
                                  <p key={subj.name} className="text-sm text-gray-600">
                                    <span className="font-medium">{subj.name}:</span> {subj.notes}
                                  </p>
                                ))}
                              </div>
                            </div>
                          )}
                        </div>
                      ))}
                    </div>
                  )}
                </div>
                
                <div className="p-6 border-t">
                  <button
                    onClick={() => setShowReflectionsPopup(false)}
                    className="w-full py-3 rounded-lg font-semibold bg-indigo-600 text-white hover:bg-indigo-700 transition-all"
                  >
                    Close
                  </button>
                </div>
              </div>
            </div>
          )}

          <div className="max-w-4xl mx-auto">
            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-3">
                  <BookOpen className="text-indigo-600" size={32} />
                  <div>
                    <h1 className="text-3xl font-bold text-gray-800">Board Exam Prep</h1>
                    <p className="text-sm text-gray-600">{formatDate(getCurrentDate())}</p>
                  </div>
                </div>
                <div className="text-right">
                  <div className="text-sm text-gray-600">Day Progress</div>
                  <div className="text-3xl font-bold text-indigo-600">
                    {currentDay}<span className="text-xl text-gray-400">/20</span>
                  </div>
                </div>
              </div>

              <div className="relative">
                <div className="w-full bg-gray-200 rounded-full h-3">
                  <div 
                    className="bg-gradient-to-r from-indigo-500 to-purple-500 h-3 rounded-full transition-all"
                    style={{ width: `${(currentDay / 20) * 100}%` }}
                  />
                </div>
                <div className="flex justify-between mt-2 text-xs text-gray-500">
                  <span>Day 1</span>
                  <span>Day 20</span>
                </div>
              </div>
            </div>

            <div className="bg-white rounded-lg shadow-lg p-6">
              <div className="flex items-center justify-between mb-6">
                <div>
                  <h2 className="text-2xl font-semibold text-gray-800">Today's Study Tasks</h2>
                  {totalCount > 0 && (
                    <p className="text-sm text-gray-600 mt-1">
                      {completedCount} of {totalCount} completed
                    </p>
         